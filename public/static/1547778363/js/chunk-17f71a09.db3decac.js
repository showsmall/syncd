(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17f71a09"],{"214f":function(t,e,a){"use strict";var i=a("32e9"),n=a("2aba"),o=a("79e5"),r=a("be13"),s=a("2b4c");t.exports=function(t,e,a){var l=s(t),c=a(r,l,""[t]),u=c[0],d=c[1];o(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(n(String.prototype,t,u),i(RegExp.prototype,l,2==e?function(t,e){return d.call(t,this,e)}:function(t){return d.call(t,this)}))}},"386d":function(t,e,a){a("214f")("search",1,function(t,e,a){return[function(a){"use strict";var i=t(this),n=void 0==a?void 0:a[e];return void 0!==n?n.call(a,i):new RegExp(a)[e](String(i))},a]})},39388:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-card",{staticClass:"app-card",attrs:{bordered:!1}},[a("div",{staticClass:"app-btn-group"},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:4}},[t.$root.CheckPriv(t.$root.Priv.SERVER_NEW)?a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleOpenAddServerDialog}},[t._v("新增服务器")]):t._e()],1),a("a-col",{attrs:{span:10}}),a("a-col",{attrs:{span:4}},[a("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",showSearch:"",placeholder:"搜索指定集群",notFoundContent:"无集群数据",optionFilterProp:"children"},model:{value:t.search.groupId,callback:function(e){t.$set(t.search,"groupId",e)},expression:"search.groupId"}},t._l(t.dialogGroupList,function(e){return a("a-select-option",{attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),a("a-col",{attrs:{span:6}},[a("a-input-search",{attrs:{placeholder:"关键词搜索，ID、名称、IP",enterButton:""},on:{search:t.handleSearch},model:{value:t.search.keyword,callback:function(e){t.$set(t.search,"keyword",e)},expression:"search.keyword"}})],1)],1)],1),a("a-table",{attrs:{columns:t.tableColumns,dataSource:t.tableSource,pagination:t.pagination,loading:t.tableLoading},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"group_id",fn:function(e,i){return[t.groupList[e]?a("span",[t._v(t._s(t.groupList[e].name))]):a("span",[a("span",{staticClass:"app-line-through"},[t._v("已删除")])])]}},{key:"op",fn:function(e,i){return a("span",{},[t.$root.CheckPriv(t.$root.Priv.SERVER_EDIT)?a("span",{staticClass:"app-link app-op",on:{click:function(e){t.handleOpenEditServerDialog(i.id)}}},[a("a-icon",{attrs:{type:"edit"}}),t._v("编辑")],1):t._e(),t.$root.CheckPriv(t.$root.Priv.SERVER_DEL)?a("a-popconfirm",{attrs:{title:"确定要删除此服务器吗？",okText:"删除",cancelText:"取消"},on:{confirm:function(e){t.handleDeleteServer(i.id)}}},[a("span",{staticClass:"app-link app-op app-remove"},[a("a-icon",{attrs:{type:"delete"}}),t._v("删除")],1)]):t._e()],1)}}])})],1),a("a-modal",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,confirmLoading:t.dialogConfirmLoading,keyboard:!1,maskClosable:!1,okText:"确定",cancelText:"取消",destroyOnClose:!0},on:{ok:t.dialogSubmit,cancel:t.dialogCancel}},[a("a-spin",{attrs:{spinning:t.dialogLoading}},[a("server-update-component",{ref:"groupUpdateRef",attrs:{"group-list":t.dialogGroupList,detail:t.dialogDetail}})],1)],1)],1)},n=[],o=(a("386d"),a("ac6a"),a("92fa")),r=a.n(o),s=(a("7f7f"),a("24b4")),l={render:function(){var t=arguments[0],e=this.form,a=e.getFieldDecorator,i=(e.getFieldValue,{labelCol:{span:6},wrapperCol:{span:15}}),n=[];return this.groupList.forEach(function(e){n.push(t("a-select-option",{attrs:{value:e.id}},[e.name]))}),a("id",{initialValue:this.detail.id}),t("a-form",[t("a-form-item",r()([{props:i},{attrs:{label:"所属集群"}}]),[a("group_id",{rules:[{required:!0,message:"请选择服务器所属分组"}],initialValue:this.detail.group_id})(t("a-select",{attrs:{allowClear:!0,showSearch:!0,placeholder:"支持关键词搜索",notFoundContent:"无分组数据",optionFilterProp:"children"}},[n]))]),t("a-form-item",r()([{props:i},{attrs:{label:"服务器名称"}}]),[a("name",{rules:[{required:!0,message:"服务器名称不能为空"}],initialValue:this.detail.name})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入服务器名称"}}))]),t("a-form-item",r()([{props:i},{attrs:{label:"IP/域名"}}]),[a("ip",{rules:[{required:!0,message:"服务器IP或域名不能为空"}],initialValue:this.detail.ip})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入服务器IP或域名"}}))]),t("a-form-item",r()([{props:i},{attrs:{label:"ssh端口"}}]),[a("ssh_port",{rules:[{required:!0,type:"integer",min:1,max:65535,message:"请输入正确ssh端口号，1-65535之间的数字"}],initialValue:this.detail.ssh_port?this.detail.ssh_port:22,normalize:function(t){var e=parseInt(t);return isNaN(e)?t:e}})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入ssh端口"}}))])])},props:{detail:{default:function(){return{}},type:Object},groupList:{default:function(){return[]},type:Array}}},c=s["Form"].create()(l),u=a("aa22"),d={data:function(){return{tableColumns:[{dataIndex:"id",title:"ID",width:"6%"},{dataIndex:"name",title:"名称"},{dataIndex:"group_id",title:"集群",width:"20%",scopedSlots:{customRender:"group_id"}},{dataIndex:"ip",title:"IP/域名",width:"18%"},{dataIndex:"ssh_port",title:"SSH Port",width:"10%"},{dataIndex:"op",title:"操作",width:"20%",align:"right",scopedSlots:{customRender:"op"}}],tableSource:[],pagination:{pageSize:10,current:1,total:0},tableLoading:!1,dialogTitle:"",dialogVisible:!1,dialogConfirmLoading:!1,dialogDetail:{},dialogGroupList:[],dialogLoading:!1,search:{keyword:"",groupId:void 0}}},components:{ServerUpdateComponent:c},computed:{groupList:function(){var t={};return this.dialogGroupList.forEach(function(e){t[e.id]=e}),t}},methods:{handleSearch:function(t){this.search.keyword=t,this.pagination.current=1,this.handleTableChange(this.pagination)},handleTableChange:function(t){this.pagination.current=t.current,this.getDataList({page:t.current,pageSize:t.pageSize})},handleOpenAddServerDialog:function(){this.dialogTitle="新增服务器",this.dialogVisible=!0,this.dialogDetail={}},handleOpenEditServerDialog:function(t){this.dialogTitle="编辑服务器信息",this.dialogVisible=!0,this.dialogDetail={},this.getDataDetail(t)},handleDeleteServer:function(t){var e=this;Object(u["b"])({id:t}).then(function(t){e.$message.success("删除成功",1),e.$root.ResetPagination(e.pagination),e.handleTableChange(e.pagination)})},dialogCancel:function(){this.dialogVisible=!1},dialogSubmit:function(){var t=this;this.$refs.groupUpdateRef.validateFields(function(e,a){e||(t.dialogConfirmLoading=!0,t.dialogDetail.id?Object(u["j"])(a).then(function(e){t.$message.success("服务器信息更新成功",1,function(){t.dialogCancel(),t.dialogConfirmLoading=!1,t.handleTableChange(t.pagination)})}).catch(function(e){t.dialogConfirmLoading=!1}):Object(u["h"])(a).then(function(e){t.$message.success("服务器信息创建成功",1,function(){t.dialogCancel(),t.dialogConfirmLoading=!1,t.handleTableChange(t.pagination)})}).catch(function(e){t.dialogConfirmLoading=!1}))})},getDataDetail:function(t){var e=this;this.dialogLoading=!0,Object(u["e"])({id:t}).then(function(t){e.dialogLoading=!1,e.dialogDetail=t}).catch(function(t){e.dialogLoading=!1})},getDataList:function(t){var e=this;this.tableLoading=!0;var a=(t.page-1)*t.pageSize,i=this.search.groupId?this.search.groupId:0,n=this.search.keyword;Object(u["f"])({group_id:i,keyword:n,offset:a,limit:t.pageSize}).then(function(t){e.tableLoading=!1,e.pagination.total=t.total,e.tableSource=t.list}).catch(function(t){e.tableLoading=!1})},getDataGroupList:function(){var t=this;Object(u["d"])({offset:0,limit:9999}).then(function(e){e.list&&(t.dialogGroupList=e.list)})}},mounted:function(){this.getDataGroupList();var t=this.$route.query.op,e=this.$route.query.id;"edit"==t&&e>0?(this.handleOpenEditServerDialog(e),this.handleSearch(e)):this.handleTableChange(this.pagination)}},p=d,g=a("2877"),h=Object(g["a"])(p,i,n,!1,null,null,null);h.options.__file="Server.vue";e["default"]=h.exports},"92fa":function(t,e){var a=/^(attrs|props|on|nativeOn|class|style|hook)$/;function i(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}}t.exports=function(t){return t.reduce(function(t,e){var n,o,r,s,l;for(r in e)if(n=t[r],o=e[r],n&&a.test(r))if("class"===r&&("string"===typeof n&&(l=n,t[r]=n={},n[l]=!0),"string"===typeof o&&(l=o,e[r]=o={},o[l]=!0)),"on"===r||"nativeOn"===r||"hook"===r)for(s in o)n[s]=i(n[s],o[s]);else if(Array.isArray(n))t[r]=n.concat(o);else if(Array.isArray(o))t[r]=[n].concat(o);else for(s in o)n[s]=o[s];else t[r]=e[r];return t},{})}},aa22:function(t,e,a){"use strict";a.d(e,"g",function(){return n}),a.d(e,"i",function(){return o}),a.d(e,"d",function(){return r}),a.d(e,"c",function(){return s}),a.d(e,"a",function(){return l}),a.d(e,"h",function(){return c}),a.d(e,"j",function(){return u}),a.d(e,"f",function(){return d}),a.d(e,"e",function(){return p}),a.d(e,"b",function(){return g});var i=a("e1d2");function n(t){return Object(i["b"])("/server/group/new",t)}function o(t){return Object(i["b"])("/server/group/update",t)}function r(t){return Object(i["a"])("/server/group/list",t)}function s(t){return Object(i["a"])("/server/group/detail",t)}function l(t){return Object(i["b"])("/server/group/delete",t)}function c(t){return Object(i["b"])("/server/new",t)}function u(t){return Object(i["b"])("/server/update",t)}function d(t){return Object(i["a"])("/server/list",t)}function p(t){return Object(i["a"])("/server/detail",t)}function g(t){return Object(i["b"])("/server/delete",t)}}}]);