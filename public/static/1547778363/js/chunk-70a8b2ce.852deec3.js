(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70a8b2ce"],{"11e9":function(e,t,a){var r=a("52a7"),i=a("4630"),n=a("6821"),o=a("6a99"),l=a("69a8"),s=a("c69a"),c=Object.getOwnPropertyDescriptor;t.f=a("9e1e")?c:function(e,t){if(e=n(e),t=o(t,!0),s)try{return c(e,t)}catch(a){}if(l(e,t))return i(!r.f.call(e,t),e[t])}},"214f":function(e,t,a){"use strict";var r=a("32e9"),i=a("2aba"),n=a("79e5"),o=a("be13"),l=a("2b4c");e.exports=function(e,t,a){var s=l(e),c=a(o,s,""[e]),p=c[0],u=c[1];n(function(){var t={};return t[s]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,p),r(RegExp.prototype,s,2==t?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)}))}},"24d2":function(e,t,a){"use strict";a.d(t,"m",function(){return i}),a.d(t,"r",function(){return n}),a.d(t,"l",function(){return o}),a.d(t,"h",function(){return l}),a.d(t,"f",function(){return s}),a.d(t,"b",function(){return c}),a.d(t,"j",function(){return p}),a.d(t,"n",function(){return u}),a.d(t,"s",function(){return d}),a.d(t,"i",function(){return f}),a.d(t,"g",function(){return h}),a.d(t,"e",function(){return b}),a.d(t,"c",function(){return m}),a.d(t,"a",function(){return v}),a.d(t,"k",function(){return g}),a.d(t,"o",function(){return _}),a.d(t,"q",function(){return C}),a.d(t,"p",function(){return y}),a.d(t,"d",function(){return j});a("cadf"),a("551c"),a("097d");var r=a("e1d2");function i(e){return Object(r["b"])("/project/new",e)}function n(e){return Object(r["b"])("/project/update",e)}function o(e){return Object(r["a"])("/project/list",e)}function l(e){return Object(r["a"])("/project/detail",e)}function s(e){return Object(r["b"])("/project/delete",e)}function c(e){return Object(r["b"])("/project/status/change",e)}function p(e){return Object(r["a"])("/project/space/list",e)}function u(e){return Object(r["b"])("/project/space/new",e)}function d(e){return Object(r["b"])("/project/space/update",e)}function f(e){return Object(r["a"])("/project/space/detail",e)}function h(e){return Object(r["b"])("/project/space/delete",e)}function b(e){return Object(r["a"])("/project/space/exists",e)}function m(e){return Object(r["a"])("/project/exists",e)}function v(e){return Object(r["b"])("/project/user/add",e)}function g(e){return Object(r["a"])("/project/user/list",e)}function _(e){return Object(r["b"])("/project/user/remove",e)}function C(e){return Object(r["a"])("/project/user/search",e)}function y(e){return Object(r["b"])("/project/repo/reset",e)}function j(e){return Object(r["a"])("/project/server/check",e)}},"386d":function(e,t,a){a("214f")("search",1,function(e,t,a){return[function(a){"use strict";var r=e(this),i=void 0==a?void 0:a[t];return void 0!==i?i.call(a,r):new RegExp(a)[t](String(r))},a]})},"52a7":function(e,t){t.f={}.propertyIsEnumerable},"5dbc":function(e,t,a){var r=a("d3f4"),i=a("8b97").set;e.exports=function(e,t,a){var n,o=t.constructor;return o!==a&&"function"==typeof o&&(n=o.prototype)!==a.prototype&&r(n)&&i&&i(e,n),e}},"8b97":function(e,t,a){var r=a("d3f4"),i=a("cb7c"),n=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=a("9b43")(Function.call,a("11e9").f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(i){t=!0}return function(e,a){return n(e,a),t?e.__proto__=a:r(e,a),e}}({},!1):void 0),check:n}},9093:function(e,t,a){var r=a("ce10"),i=a("e11e").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},"92fa":function(e,t){var a=/^(attrs|props|on|nativeOn|class|style|hook)$/;function r(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}}e.exports=function(e){return e.reduce(function(e,t){var i,n,o,l,s;for(o in t)if(i=e[o],n=t[o],i&&a.test(o))if("class"===o&&("string"===typeof i&&(s=i,e[o]=i={},i[s]=!0),"string"===typeof n&&(s=n,t[o]=n={},n[s]=!0)),"on"===o||"nativeOn"===o||"hook"===o)for(l in n)i[l]=r(i[l],n[l]);else if(Array.isArray(i))e[o]=i.concat(n);else if(Array.isArray(n))e[o]=[i].concat(n);else for(l in n)i[l]=n[l];else e[o]=t[o];return e},{})}},aa22:function(e,t,a){"use strict";a.d(t,"g",function(){return i}),a.d(t,"i",function(){return n}),a.d(t,"d",function(){return o}),a.d(t,"c",function(){return l}),a.d(t,"a",function(){return s}),a.d(t,"h",function(){return c}),a.d(t,"j",function(){return p}),a.d(t,"f",function(){return u}),a.d(t,"e",function(){return d}),a.d(t,"b",function(){return f});var r=a("e1d2");function i(e){return Object(r["b"])("/server/group/new",e)}function n(e){return Object(r["b"])("/server/group/update",e)}function o(e){return Object(r["a"])("/server/group/list",e)}function l(e){return Object(r["a"])("/server/group/detail",e)}function s(e){return Object(r["b"])("/server/group/delete",e)}function c(e){return Object(r["b"])("/server/new",e)}function p(e){return Object(r["b"])("/server/update",e)}function u(e){return Object(r["a"])("/server/list",e)}function d(e){return Object(r["a"])("/server/detail",e)}function f(e){return Object(r["b"])("/server/delete",e)}},aa77:function(e,t,a){var r=a("5ca1"),i=a("be13"),n=a("79e5"),o=a("fdef"),l="["+o+"]",s="​",c=RegExp("^"+l+l+"*"),p=RegExp(l+l+"*$"),u=function(e,t,a){var i={},l=n(function(){return!!o[e]()||s[e]()!=s}),c=i[e]=l?t(d):o[e];a&&(i[a]=c),r(r.P+r.F*l,"String",i)},d=u.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(p,"")),e};e.exports=u},b7bc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{staticClass:"app-card",attrs:{title:"项目管理",bordered:!1}},[a("a-spin",{attrs:{spinning:e.spaceLoading,tip:"Loading..."}},[a("div",{staticClass:"app-content-list"},[a("h3",[e._v(e._s(this.spaceDetail.name))]),this.spaceDetail.description?a("p",{staticClass:"description"},[e._v(e._s(this.spaceDetail.description))]):e._e()])]),a("a-divider"),a("div",{staticClass:"app-btn-group"},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:4}},[e.$root.CheckPriv(e.$root.Priv.PROJECT_NEW)?a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleOpenAddDialog}},[e._v("新增项目")]):e._e()],1),a("a-col",{attrs:{span:14}}),a("a-col",{attrs:{span:6}},[a("a-input-search",{attrs:{placeholder:"关键词搜索，ID、名称",enterButton:""},on:{search:e.handleSearch},model:{value:e.search.keyword,callback:function(t){e.$set(e.search,"keyword",t)},expression:"search.keyword"}})],1)],1)],1),a("a-table",{attrs:{columns:e.tableColumns,dataSource:e.tableSource,pagination:e.pagination,loading:e.tableLoading},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"repo_mode",fn:function(t){return[a("span",1==t?[e._v("分支")]:[e._v("Tag")])]}},{key:"status",fn:function(t,r){return[e.$root.CheckPriv(e.$root.Priv.PROJECT_AUDIT)?[a("a-switch",{attrs:{checkedChildren:"启用",unCheckedChildren:"未启用"},on:{click:function(t){e.handleProjectChange(r)}},model:{value:r.status,callback:function(t){e.$set(r,"status",t)},expression:"record.status"}})]:[e._v("\n                    "+e._s(r.status?"已启用":"未启用")+"\n                ")]]}},{key:"need_audit",fn:function(t){return[a("span",1==t?[e._v("是")]:[e._v("否")])]}},{key:"op",fn:function(t,r){return a("span",{},[e.$root.CheckPriv(e.$root.Priv.PROJECT_CHECK)?a("span",{staticClass:"app-link app-op",on:{click:function(t){e.handleCheck(r.id)}}},[a("a-icon",{attrs:{type:"thunderbolt"}}),e._v("集群检测")],1):e._e(),e.$root.CheckPriv(e.$root.Priv.PROJECT_REPO)?a("span",{staticClass:"app-link app-op",on:{click:function(t){e.handleResetRepo(r.id)}}},[a("a-icon",{attrs:{type:"scan"}}),e._v("仓库重置")],1):e._e(),e.$root.CheckPriv(e.$root.Priv.PROJECT_VIEW)?a("span",{staticClass:"app-link app-op",on:{click:function(t){e.handleOpenViewDialog(r.id)}}},[a("a-icon",{attrs:{type:"eye"}}),e._v("查看")],1):e._e(),e.$root.CheckPriv(e.$root.Priv.PROJECT_EDIT)?a("span",{staticClass:"app-link app-op",on:{click:function(t){e.handleOpenUpdateDialog(r.id)}}},[a("a-icon",{attrs:{type:"edit"}}),e._v("编辑")],1):e._e(),e.$root.CheckPriv(e.$root.Priv.PROJECT_DEL)?[0==r.status?[a("a-popconfirm",{attrs:{title:"确定要删除此分组吗？",okText:"删除",cancelText:"取消"},on:{confirm:function(t){e.handleDeleteProject(r.id)}}},[a("span",{staticClass:"app-link app-op app-remove"},[a("a-icon",{attrs:{type:"delete"}}),e._v("删除")],1)])]:[a("a-tooltip",{attrs:{placement:"topRight"}},[a("template",{slot:"title"},[a("span",[e._v("删除项目前请先停用项目")])]),a("span",{staticClass:"app-op app-color-gray app-no-allow"},[a("a-icon",{attrs:{type:"delete"}}),e._v("删除")],1)],2)]]:e._e()],2)}}])})],1),a("a-modal",{attrs:{title:"查看项目",visible:e.dialogViewVisible,destroyOnClose:!0,footer:null,width:"60vw"},on:{cancel:function(t){e.dialogViewVisible=!1}}},[a("project-view-component",{attrs:{"project-id":e.projectId}})],1),a("a-modal",{attrs:{title:"编辑项目",visible:e.dialogUpdateVisible,destroyOnClose:!0,footer:null,keyboard:!1,maskClosable:!1,width:"60vw"},on:{cancel:function(t){e.dialogUpdateVisible=!1}}},[a("project-update-component",{attrs:{"space-id":e.spaceId,"project-id":e.projectId},on:{close:e.closeUpdateDialog}})],1)],1)},i=[],n=(a("7f7f"),a("ac6a"),a("386d"),a("24d2")),o=a("aa22"),l=(a("c5f6"),a("24b4")),s={render:function(){var e=arguments[0],t={labelCol:{span:4},wrapperCol:{span:18}};return e("a-spin",{attrs:{spinning:this.loading}},[e("a-form",[e("a-form-item",{attrs:{label:"项目ID",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.id]),e("a-form-item",{attrs:{label:"项目名称",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.name]),e("a-form-item",{attrs:{label:"项目描述",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.description]),e("a-form-item",{attrs:{label:"开启审核",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.need_audit?"需要审核":"不需要审核"]),e("a-form-item",{attrs:{label:"项目启用",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[1==this.detail.status?e("span",{class:"app-color-success"},[e("a-icon",{attrs:{type:"check"}})," 已启用"]):e("span",{class:"app-color-error"},[e("a-icon",{attrs:{type:"close"}})," 未启用"])]),e("a-divider"),e("a-form-item",{attrs:{label:"代码仓库地址",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.repo_url]),e("a-form-item",{attrs:{label:"上线模式",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.repo_mode?e("span",[e("a-icon",{attrs:{type:"branches"}})," 分支上线 - ",e("strong",[this.detail.repo_branch])," 分支"]):e("span",[e("a-icon",{attrs:{type:"tag"}})," Tag上线"])]),e("a-divider"),e("a-form-item",{attrs:{label:"上线集群",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[function(t){var a=[];return t&&t.forEach(function(t){a.push(e("a-tooltip",{attrs:{placement:"top"}},[e("template",{slot:"title"},[e("span",["集群ID: ",t.id,", 集群名称: ",t.name])]),e("a-tag",[e("a-icon",{attrs:{type:"cluster"}})," ",t.name])]))}),a}(this.detail.deploy_servers)]),e("a-form-item",{attrs:{label:"用户",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.deploy_user]),e("a-form-item",{attrs:{label:"目录",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.deploy_path]),e("a-form-item",{attrs:{label:"部署前运行命令",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[e("pre",{class:"app-shell"},[this.detail.pre_deploy_cmd])]),e("a-form-item",{attrs:{label:"部署后运行命令",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[e("pre",{class:"app-shell"},[this.detail.post_deploy_cmd])]),e("a-form-item",{attrs:{label:"部署超时时间(秒)",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.deploy_timeout," 秒"]),e("a-divider"),e("a-form-item",{attrs:{label:"审核通知",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.audit_notice_email]),e("a-form-item",{attrs:{label:"上线通知",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[this.detail.deploy_notice_email])])])},props:{projectId:Number},data:function(){return{loading:!1,detail:{}}},methods:{getDetail:function(e){var t=this;this.loading=!0,Object(n["h"])({id:e}).then(function(e){t.loading=!1,t.detail=e})}},mounted:function(){this.getDetail(this.projectId)}},c=l["Form"].create()(s);function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){p(e,t,a[t])})}return e}var d=a("92fa"),f=a.n(d),h={render:function(){var e=this,t=arguments[0],a=this.form,r=a.getFieldDecorator,i=a.getFieldValue,o=(a.setFieldsValue,{labelCol:{span:4},wrapperCol:{span:18}}),l={labelCol:{span:4},wrapperCol:{span:6}},s=function(){var a=[];return e.serverGroupList.forEach(function(e){a.push(t("a-select-option",{attrs:{value:e.id}},[e.name]))}),a},c=function(){var a=i("deploy_server"),r=[];a&&a.forEach(function(a,i){var n=e.findServerItem(a);n.id&&r.push(t("div",{class:"ant-list-item"},[t("div",{class:"ant-list-item-content ant-list-item-content-single"},[i+1,". ",n.name," (ID:",n.id,")"]),t("ul",{class:"ant-list-item-action"},[t("li",[t("a",{on:{click:e.removeServerItem.bind(e,a)},class:"oper-delete"},[t("icon-delete"),"移除"])])])]))});var n="";return r.length&&(n=t("div",{class:"app-server-group-list"},[t("div",{class:"title"},["已选集群列表"]),t("div",{class:"ant-list ant-list-split ant-list-bordered"},[t("div",{class:"ant-spin-nested-loading"},[t("div",{class:"ant-spin-container",style:"max-height: 200px; overflow-y: auto;"},[r])])])])),n},p=this,u=function(e,t,a){t?(p.nameHelp="正在验证名称是否被占用...",Object(n["c"])({id:p.detail.id,space_id:p.spaceId,keyword:t}).then(function(e){e.exists?(p.nameHelp="抱歉！该名称已经存在，请重新输入",a("抱歉！该名称已经存在，请重新输入")):(p.nameHelp=void 0,a())}).catch(function(e){p.nameHelp="网络错误, 校验失败",a("网络错误, 校验失败")})):a()};return t("a-form",{on:{submit:this.handleSubmit}},[t("a-spin",{attrs:{spinning:this.detailLoading}},[t("a-form-item",f()([{props:o},{attrs:{help:this.nameHelp,label:"项目名称"}}]),[r("name",{rules:[{required:!0,message:"项目名称不能为空"},{validator:u}],initialValue:this.detail.name,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入项目名称"}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"项目描述"}}]),[r("description",{rules:[{required:!0,message:"项目名称不能为空"}],initialValue:this.detail.description,validateTrigger:"blur"})(t("a-textarea",{attrs:{placeholder:"请输入项目描述信息",rows:3}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"开启审核",help:"开启后，上线单需要审核通过后才能发起上线"}}]),[r("need_audit",{initialValue:!!this.detail.need_audit,valuePropName:"checked"})(t("a-switch",{attrs:{checkedChildren:"开启",unCheckedChildren:"关闭"}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"项目状态"}}]),[1==this.detail.status?t("span",{class:"app-color-success"},[t("a-icon",{attrs:{type:"check"}})," 已启用"]):t("span",{class:"app-color-error"},[t("a-icon",{attrs:{type:"close"}})," 未启用"])]),t("a-divider"),t("a-form-item",f()([{props:o},{attrs:{label:"Git仓库地址"}}]),[r("repo_url",{rules:[{required:!0,message:"代码仓库地址不能为空"}],initialValue:this.detail.repo_url,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入代码仓库地址"}}))]),t("a-form-item",f()([{props:o},{attrs:{help:"测试环境推荐分支上线，生产环境推荐tag上线",label:"上线模式"}}]),[r("repo_mode",{rules:[{required:!0,message:"请选择上线模式"}],initialValue:this.detail.repo_mode?this.detail.repo_mode:1})(t("a-radio-group",[t("a-radio",{attrs:{value:1}},["分支上线"]),t("a-radio",{attrs:{value:2}},["tag上线"])]))]),1==i("repo_mode")?t("a-form-item",f()([{props:l},{attrs:{label:"指定上线分支"}}]),[r("repo_branch",{rules:[{required:!0,message:"请输入指定上线分支"}],initialValue:this.detail.repo_branch,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"上线分支"}}))]):"",t("a-form-item",f()([{props:o},{attrs:{label:"排除文件"}}]),[r("exclude_files",{initialValue:this.detail.exclude_files})(t("a-textarea",{attrs:{placeholder:"请输入要排除的文件",rows:3}})),t("div",["排除不上线的文件，一行一个，支持通配符 `*`"])]),t("a-divider"),t("a-form-item",f()([{props:o},{attrs:{label:"选择上线集群"}}]),[t("a-select",{attrs:{allowClear:!0,showSearch:!0,placeholder:"关键词搜索",notFoundContent:"无数据",optionFilterProp:"children"},style:{width:"200px"},on:{select:this.handleServerSelect}},[s()]),r("deploy_server",{rules:[{required:!0,message:"请选择上线集群"}],initialValue:this.detail.deploy_server?this.detail.deploy_server:[]})(t("div",[c()]))]),t("a-form-item",f()([{props:l},{attrs:{label:"用户"}}]),[r("deploy_user",{rules:[{required:!0,message:"请选择上线集群"}],initialValue:this.detail.deploy_user})(t("a-input",{attrs:{autocomplete:"off",placeholder:"目标机用户"}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"目录"}}]),[r("deploy_path",{rules:[{required:!0,message:"请设置代码部署目录"}],initialValue:this.detail.deploy_path,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"代码/包部署的目录"}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"部署前运行命令"}}]),[r("pre_deploy_cmd",{initialValue:this.detail.pre_deploy_cmd})(t("a-textarea",{attrs:{placeholder:"代码部署之前运行的命令, 每行一个命令",rows:3}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"部署后运行命令"}}]),[r("post_deploy_cmd",{initialValue:this.detail.post_deploy_cmd})(t("a-textarea",{attrs:{placeholder:"代码部署之后运行的命令, 每行一个命令",rows:3}}))]),t("a-form-item",f()([{props:l},{attrs:{label:"部署超时时间(秒)"}}]),[r("deploy_timeout",{rules:[{required:!0,message:"请设置部署超时时间"},{validator:function(e,t,a){if(t){var r=Number(t);isNaN(r)||parseInt(r)!=r?a("请输入有效正整数"):r<1?a("请输入有效正整数"):a()}else a()}}],initialValue:this.detail.deploy_timeout?this.detail.deploy_timeout:120,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"部署超时时间"}}))]),t("a-divider"),t("a-form-item",f()([{props:o},{attrs:{label:"审核通知"}}]),[t("div",{slot:"help"},["用户提交待审核上线单时, 系统会通过邮件通知相关leader及时审核, 多个邮箱地址请用 `,` 相隔"]),r("audit_notice_email",{initialValue:this.detail.audit_notice_email,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入接收审核通知的邮箱地址"}}))]),t("a-form-item",f()([{props:o},{attrs:{label:"上线通知"}}]),[t("div",{slot:"help"},["接收上线通知的邮箱地址, 多个邮箱地址请用 `,` 相隔"]),r("deploy_notice_email",{initialValue:this.detail.deploy_notice_email,validateTrigger:"blur"})(t("a-input",{attrs:{autocomplete:"off",placeholder:"请输入接收上线通知的邮箱地址"}}))]),t("a-divider"),t("div",{style:"text-align: right"},[t("a-button",{attrs:{type:"primary",htmlType:"submit"}},["提交"])])])])},props:{projectId:{type:Number,default:0},spaceId:{type:Number,default:0}},data:function(){return{id:0,detail:{},serverGroupList:[],detailLoading:!1,nameHelp:void 0}},methods:{handleSubmit:function(e){var t=this,a=this.$createElement;e.preventDefault(),this.form.validateFields(function(e,r){if(e)t.$root.ResolveFormError(e,r);else{var i=u({},r);t.spaceId?(i.space_id=t.spaceId,i.id=t.projectId,i.need_audit=i.need_audit?1:0,i.deploy_server=t.filterInvalidServerGroup(i.deploy_server),t.projectId?Object(n["r"])(i).then(function(e){t.$success({title:"更新成功",okText:"确定",content:a("div",["恭喜，项目更新成功，点击确定返回项目列表"]),onOk:function(){t.$emit("close")}})}):Object(n["m"])(i).then(function(e){t.$success({title:"新增成功",okText:"确定",content:a("div",["恭喜，项目新增成功，点击确定返回项目列表"]),onOk:function(){t.$emit("close")}})})):t.$error({title:"参数错误",content:a("div",["项目空间ID丢失，操作失败，请重试!"])})}})},handleServerSelect:function(e){var t=this.form.getFieldValue("deploy_server");t||(t=[]),-1==t.indexOf(e)&&t.push(e),this.form.setFieldsValue({deploy_server:t})},findServerItem:function(e){var t={};return this.serverGroupList.forEach(function(a){a.id==e&&(t=a)}),t},removeServerItem:function(e){var t=this.form.getFieldValue("deploy_server");t||(t=[]);var a=t.indexOf(e);a>-1&&t.splice(a,1),this.form.setFieldsValue({deploy_server:t})},filterInvalidServerGroup:function(e){var t=this,a=[];return e&&e.forEach(function(e){t.findServerItem(e).id&&a.push(e)}),a},getDataDetail:function(e){var t=this;this.detailLoading=!0,Object(n["h"])({id:e}).then(function(e){t.detail=e,t.detailLoading=!1})},getDataGroupList:function(){var e=this;Object(o["d"])({offset:0,limit:9999}).then(function(t){t.list?e.serverGroupList=t.list:e.serverGroupList=[]})}},mounted:function(){this.projectId&&this.getDataDetail(this.projectId),this.getDataGroupList()}},b=l["Form"].create()(h),m={components:{ProjectViewComponent:c,ProjectUpdateComponent:b},data:function(){return{tableColumns:[{dataIndex:"id",title:"项目ID",width:"10%"},{dataIndex:"name",title:"项目名称"},{dataIndex:"repo_mode",title:"上线方式",width:"10%",align:"center",scopedSlots:{customRender:"repo_mode"}},{dataIndex:"need_audit",title:"开启审核",width:"10%",align:"center",scopedSlots:{customRender:"need_audit"}},{dataIndex:"status",title:"项目启用",width:"10%",align:"center",scopedSlots:{customRender:"status"}},{dataIndex:"op",title:"操作",width:"35%",align:"right",scopedSlots:{customRender:"op"}}],tableLoading:!1,tableSource:[],pagination:{pageSize:10,current:1,total:0},search:{},dialogViewVisible:!1,dialogUpdateVisible:!1,labelCol:{span:4},wrapperCol:{span:18},projectId:0,spaceId:0,spaceLoading:!1,spaceDetail:{}}},methods:{handleSearch:function(e){this.search.keyword=e,this.pagination.current=1,this.handleTableChange(this.pagination)},handleTableChange:function(e){this.pagination.current=e.current,this.getDataList({page:e.current,pageSize:e.pageSize})},handleDeleteProject:function(e){var t=this;Object(n["f"])({id:e}).then(function(e){t.$message.success("删除成功",1),t.$root.ResetPagination(t.pagination),t.handleTableChange(t.pagination)})},handleOpenAddDialog:function(){this.projectId=0,this.dialogUpdateVisible=!0},handleOpenViewDialog:function(e){this.projectId=e,this.dialogViewVisible=!0},handleOpenUpdateDialog:function(e){this.projectId=e,this.dialogUpdateVisible=!0},handleProjectChange:function(e){Object(n["b"])({id:e.id,status:e.status?1:0}).then(function(e){}).catch(function(t){e.status=!e.status})},handleResetRepo:function(e){var t=this,a=this.$createElement,r=this.$info({title:"代码仓库重置",content:a("div",["代码仓库重置中，请不要离开此页面..."]),okText:"终止",okType:"default",iconType:"loading",keyboard:!1,onOk:function(){t.$CancelAjaxRequet()}});Object(n["p"])({id:e}).then(function(e){r.destroy(),t.$success({title:"代码仓库重置成功",content:"代码仓库重置成功",okText:"知道了"})}).catch(function(e){r.destroy(),t.$error({title:"代码仓库重置失败",content:e.message,okText:"知道了"})})},closeUpdateDialog:function(){this.dialogUpdateVisible=!1,this.handleTableChange(this.pagination)},handleCheck:function(e){var t=this,a=this.$createElement,r=this.$info({title:"集群连通性检测",content:a("div",["服务器集群连通性检测中，请不要刷新或离开页面..."]),okText:"终止检测",okType:"default",iconType:"loading",keyboard:!1,onOk:function(){t.$CancelAjaxRequet()}});Object(n["d"])({id:e}).then(function(e){r.destroy();var i=[];e.srv_list&&e.srv_list.forEach(function(e){i.push(a("div",[e.ip," - ",e.name]))}),t.$success({title:"集群连通性检测成功",content:a("div",[a("h4",["服务器列表"]),a("div",[i])]),okText:"知道了"})}).catch(function(e){r.destroy(),t.$IsCancel(e)||t.$error({title:"集群连通性检测失败",content:a("div",[a("h4",["输出日志"]),a("pre",[e.message])]),okText:"知道了"})})},getDataList:function(e){var t=this;this.tableLoading=!0;var a=(e.page-1)*e.pageSize;Object(n["l"])({space_id:this.spaceId,keyword:this.search.keyword,offset:a,limit:e.pageSize}).then(function(e){t.tableLoading=!1,t.pagination.total=e.total,e.list&&e.list.forEach(function(t,a){e.list[a].status=!!t.status}),t.tableSource=e.list}).catch(function(e){t.tableLoading=!1})},getSpaceDetail:function(e){var t=this;this.spaceLoading=!0,Object(n["i"])({id:e}).then(function(e){t.spaceLoading=!1,t.spaceDetail=e}).catch(function(e){t.spaceLoading=!1})}},mounted:function(){var e=parseInt(this.$route.query.space);e||this.$root.GotoRouter("projectSpace"),this.spaceId=e,this.getSpaceDetail(this.spaceId),this.handleTableChange(this.pagination)}},v=m,g=a("2877"),_=Object(g["a"])(v,r,i,!1,null,null,null);_.options.__file="Project.vue";t["default"]=_.exports},c5f6:function(e,t,a){"use strict";var r=a("7726"),i=a("69a8"),n=a("2d95"),o=a("5dbc"),l=a("6a99"),s=a("79e5"),c=a("9093").f,p=a("11e9").f,u=a("86cc").f,d=a("aa77").trim,f="Number",h=r[f],b=h,m=h.prototype,v=n(a("2aeb")(m))==f,g="trim"in String.prototype,_=function(e){var t=l(e,!1);if("string"==typeof t&&t.length>2){t=g?t.trim():d(t,3);var a,r,i,n=t.charCodeAt(0);if(43===n||45===n){if(a=t.charCodeAt(2),88===a||120===a)return NaN}else if(48===n){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var o,s=t.slice(2),c=0,p=s.length;c<p;c++)if(o=s.charCodeAt(c),o<48||o>i)return NaN;return parseInt(s,r)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof h&&(v?s(function(){m.valueOf.call(a)}):n(a)!=f)?o(new b(_(t)),a,h):_(t)};for(var C,y=a("9e1e")?c(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j=0;y.length>j;j++)i(b,C=y[j])&&!i(h,C)&&u(h,C,p(b,C));h.prototype=m,m.constructor=h,a("2aba")(r,f,h)}},fdef:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);