(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a445eb90"],{4086:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-card",{staticClass:"app-card",attrs:{title:"提交上线申请",bordered:!1}},[i("div",{staticClass:"app-btn-group"},[i("a-row",{attrs:{gutter:10}},[i("a-col",{attrs:{span:8}},[i("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",placeholder:"请选择项目空间",notFoundContent:t.fetchingSpace?void 0:"未找到数据"},model:{value:t.selectedSpaceId,callback:function(e){t.selectedSpaceId=e},expression:"selectedSpaceId"}},[t.fetchingSpace?i("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):t._e(),t._l(t.spaceList,function(e){return i("a-select-option",{key:""+e.id},[t._v(t._s(e.name))])})],2)],1),t.selectedSpaceId?i("a-col",{attrs:{span:8}},[i("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",placeholder:"请选择项目",notFoundContent:t.fetchingProject?void 0:"未找到数据"},model:{value:t.selectedProjectId,callback:function(e){t.selectedProjectId=e},expression:"selectedProjectId"}},[t.fetchingProject?i("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):t._e(),t._l(t.projectList,function(e){return i("a-select-option",{key:""+e.id},[t._v(t._s(e.name))])})],2)],1):t._e(),t.selectedProjectId?i("a-col",{attrs:{span:8}},[i("a-button",{attrs:{type:"primary"},on:{click:t.handleOpenDialog}},[i("a-icon",{attrs:{type:"file"}}),t._v(" 填写上线单")],1)],1):t._e()],1)],1)]),i("a-modal",{attrs:{title:"填写上线申请",visible:t.dialogVisible,confirmLoading:t.dialogConfirmLoading,keyboard:!1,maskClosable:!1,okText:"提交申请",cancelText:"放弃",destroyOnClose:!0,width:"50%"},on:{ok:t.dialogSubmit,cancel:t.dialogCancel}},[i("apply-update-component",{ref:"updateRef",attrs:{detail:{project_id:this.projectId}}})],1)],1)},o=[],a=i("41db"),c=i("af43"),r={data:function(){return{fetchingSpace:!1,spaceList:[],selectedSpaceId:void 0,fetchingProject:!1,projectList:[],selectedProjectId:void 0,dialogVisible:!1,dialogConfirmLoading:!1}},components:{ApplyUpdateComponent:c["a"]},watch:{selectedSpaceId:function(t){this.loadProjectList(t),this.projectList=[],this.selectedProjectId=void 0}},computed:{projectId:function(){var t=parseInt(this.selectedProjectId);return isNaN(t)?0:t}},methods:{handleOpenDialog:function(){this.dialogVisible=!0},dialogSubmit:function(){var t=this,e=this.$createElement;this.$refs.updateRef.validateFields(function(i,n){i||(t.dialogConfirmLoading=!0,Object(a["o"])(n).then(function(i){t.dialogConfirmLoading=!1,t.$success({title:"提交成功",okText:"确定",content:e("div",["恭喜，上线申请提交成功"]),onOk:function(){t.$root.CheckPrivs([t.$root.Priv.DEPLOY_VIEW_MY,t.$root.Priv.DEPLOY_VIEW_ALL])&&t.$root.GotoRouter("deployDeploy"),t.dialogCancel()}})}).catch(function(e){t.dialogConfirmLoading=!1}))})},dialogCancel:function(){this.dialogVisible=!1},loadProjectList:function(t){var e=this;this.fetchingProject=!0,Object(a["g"])({space_id:t,status:1}).then(function(t){e.fetchingProject=!1,e.projectList=t.list,t.list||e.$message.warning("该空间下无可用项目")}).catch(function(t){e.fetchingProject=!1})},loadSpaceList:function(){var t=this;this.fetchingSpace=!0,Object(a["h"])().then(function(e){t.fetchingSpace=!1,t.spaceList=e.list}).catch(function(e){t.fetchingSpace=!1})}},mounted:function(){this.loadSpaceList()}},s=r,l=i("2877"),d=Object(l["a"])(s,n,o,!1,null,null,null);d.options.__file="Apply.vue";e["default"]=d.exports},"41db":function(t,e,i){"use strict";i.d(e,"o",function(){return o}),i.d(e,"d",function(){return a}),i.d(e,"h",function(){return c}),i.d(e,"g",function(){return r}),i.d(e,"e",function(){return s}),i.d(e,"f",function(){return l}),i.d(e,"k",function(){return d}),i.d(e,"j",function(){return p}),i.d(e,"c",function(){return u}),i.d(e,"a",function(){return f}),i.d(e,"p",function(){return h}),i.d(e,"b",function(){return g}),i.d(e,"q",function(){return m}),i.d(e,"i",function(){return b}),i.d(e,"l",function(){return y}),i.d(e,"m",function(){return j}),i.d(e,"n",function(){return v});var n=i("e1d2");function o(t){return Object(n["b"])("/deploy/apply/submit",t)}function a(t){return Object(n["a"])("/deploy/apply/list",t)}function c(t){return Object(n["a"])("/deploy/apply/space/list",t)}function r(t){return Object(n["a"])("/deploy/apply/project/list",t)}function s(t){return Object(n["a"])("/deploy/apply/project/all",t)}function l(t){return Object(n["a"])("/deploy/apply/project/detail",t)}function d(t){return Object(n["a"])("/deploy/apply/repo/taglist",t)}function p(t){return Object(n["a"])("/deploy/apply/repo/commitlist",t)}function u(t){return Object(n["a"])("/deploy/apply/detail",t)}function f(t){return Object(n["b"])("/deploy/apply/audit",t)}function h(t){return Object(n["b"])("/deploy/apply/unaudit",t)}function g(t){return Object(n["b"])("/deploy/apply/discard",t)}function m(t){return Object(n["b"])("/deploy/apply/update",t)}function b(t){return Object(n["a"])("/deploy/apply/log",t)}function y(t){return Object(n["b"])("/deploy/deploy/start",t)}function j(t){return Object(n["a"])("/deploy/deploy/status",t)}function v(t){return Object(n["b"])("/deploy/deploy/stop",t)}},"92fa":function(t,e){var i=/^(attrs|props|on|nativeOn|class|style|hook)$/;function n(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}}t.exports=function(t){return t.reduce(function(t,e){var o,a,c,r,s;for(c in e)if(o=t[c],a=e[c],o&&i.test(c))if("class"===c&&("string"===typeof o&&(s=o,t[c]=o={},o[s]=!0),"string"===typeof a&&(s=a,e[c]=a={},a[s]=!0)),"on"===c||"nativeOn"===c||"hook"===c)for(r in a)o[r]=n(o[r],a[r]);else if(Array.isArray(o))t[c]=o.concat(a);else if(Array.isArray(a))t[c]=[o].concat(a);else for(r in a)o[r]=a[r];else t[c]=e[c];return t},{})}},af43:function(t,e,i){"use strict";var n=i("92fa"),o=i.n(n),a=(i("7f7f"),i("ac6a"),i("24b4")),c=i("41db"),r={render:function(){var t=this,e=arguments[0],i=this.form,n=i.getFieldDecorator,a=i.getFieldValue,c={labelCol:{span:6},wrapperCol:{span:16}},r=function(){var i=[];return t.tagList.forEach(function(t){i.push(e("a-select-option",{attrs:{value:"".concat(t)}},["".concat(t)]))}),i},s=function(){var i=[];return t.commitList.forEach(function(t){i.push(e("a-select-option",{attrs:{value:"".concat(t)}},["".concat(t)]))}),i};return n("project_id",{initialValue:this.detail.project_id}),n("id",{initialValue:this.detail.id}),e("a-form",[e("a-form-item",o()([{props:c},{attrs:{label:"项目名称"}}]),[this.projectDetail.name]),e("a-form-item",o()([{props:c},{attrs:{label:"上线单名称"}}]),[n("name",{rules:[{required:!0,message:"上线单名称不能为空"}],validateTrigger:"blur",initialValue:this.detail.name})(e("a-input",{attrs:{autocomplete:"off",placeholder:"请输入上线单名称"}}))]),e("a-form-item",o()([{props:c},{attrs:{label:"上线模式"}}]),[1==this.projectDetail.repo_mode?e("span",[e("a-icon",{attrs:{type:"branches"}})," 分支上线 - ",e("strong",[this.projectDetail.repo_branch])," 分支"]):e("span",[e("a-icon",{attrs:{type:"tag"}})," Tag上线"])]),1==this.projectDetail.repo_mode?e("a-form-item",o()([{props:c},{attrs:{label:"选择上线版本"}}]),[n("commit",{rules:[{required:!0,message:"选择上线版本"}],validateTrigger:"blur"})(e("div")),e("div",[e("a-select",{attrs:{showSearch:!0,placeholder:"关键词搜索",notFoundContent:this.fetching?void 0:"未找到数据",defaultActiveFirstOption:!1},on:{change:this.handleSelectCommit},style:{width:"100%"}},[this.fetching?e("a-spin",{slot:"notFoundContent",attrs:{size:"small"}}):"",s()]),e("a-button",{on:{click:this.handleFetchCommitList}},[e("a-icon",{attrs:{type:"sync",spin:this.fetching}})," ",this.fetchBtnTitle]),a("commit")?e("div",{style:"line-height: 1; margin-top: 10px;"},["选择版本 - ",a("commit")]):"",this.detail.repo_branch&&this.detail.repo_commit?e("div",{style:"line-height: 1; margin-top: 10px;"},[e("p",["当前版本 - ",this.detail.repo_branch," - ",this.detail.repo_commit])]):""])]):"",2==this.projectDetail.repo_mode?e("a-form-item",o()([{props:c},{attrs:{label:"选择上线Tag"}}]),[n("tag",{rules:[{required:!0,message:"选择上线Tag"}],validateTrigger:"blur"})(e("div")),e("a-row",{attrs:{gutter:10}},[e("a-col",{attrs:{span:16}},[e("a-select",{attrs:{showSearch:!0,placeholder:"关键词搜索",notFoundContent:this.fetching?void 0:"未找到数据",defaultActiveFirstOption:!1},on:{change:this.handleSelectTags},style:{width:"100%"}},[this.fetching?e("a-spin",{slot:"notFoundContent",attrs:{size:"small"}}):"",r()])]),e("a-col",{attrs:{span:8}},[e("a-button",{on:{click:this.handleFetchTagList}},[e("a-icon",{attrs:{type:"sync",spin:this.fetching}})," ",this.fetchBtnTitle])])]),""!=this.detail.repo_tag?e("div",[this.detail.repo_tag]):""]):"",e("a-form-item",o()([{props:c},{attrs:{help:this.nameHelp,label:"上线说明"}}]),[n("description",{rules:[{required:!0,message:"请填写上线说明"}],validateTrigger:"blur",initialValue:this.detail.description})(e("a-textarea",{attrs:{placeholder:"请详细填写上线说明",rows:3}}))])])},props:{detail:{type:Object,default:function(){return{}}}},data:function(){return{projectDetail:{},fetching:!1,commitList:[],tagList:[],fetchBtnTitle:"拉取列表"}},methods:{handleSelectCommit:function(t){this.form.setFieldsValue({commit:t})},handleSelectTags:function(t){this.form.setFieldsValue({tag:t})},handleFetchCommitList:function(){var t=this;this.fetching=!0,this.fetchBtnTitle="列表拉取中...",Object(c["j"])({id:this.detail.project_id}).then(function(e){t.fetching=!1,e.list&&(t.commitList=e.list),t.fetchBtnTitle="列表拉取成功"}).catch(function(e){t.fetching=!1,t.fetchBtnTitle="列表拉取失败",t.$error({title:"列表拉取失败",content:e.message,okText:"知道了"})})},handleFetchTagList:function(){var t=this;this.fetching=!0,this.fetchBtnTitle="列表拉取中...",Object(c["k"])({id:this.detail.project_id}).then(function(e){t.fetching=!1,e.list&&(t.tagList=e.list),t.fetchBtnTitle="列表拉取成功"}).catch(function(e){t.fetching=!1,t.fetchBtnTitle="列表拉取失败",t.$error({title:"列表拉取失败",content:e.message,okText:"知道了"})})},loadProjectDetail:function(){var t=this;Object(c["f"])({id:this.detail.project_id}).then(function(e){t.projectDetail=e})}},mounted:function(){this.loadProjectDetail()}};e["a"]=a["Form"].create()(r)}}]);